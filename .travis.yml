language: rust
os: linux
dist: xenial

services:
  - docker

cache: cargo

jobs:
  fast_finish: true
  include:
    - stage: dependencies
      name: install_dependencies
      script: cargo install cross
    - stage: test
      name: test_job
      install: skip
      script: cargo test --features integration-test
    - stage: build
    - script: cross build --target x86_64-unknown-linux-gnu --release
    - script: cross build --target armv7-unknown-linux-gnueabihf --release
    - script: cross build --target arm-unknown-linux-gnueabihf --release
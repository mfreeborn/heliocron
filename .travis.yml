language: rust
os: linux
dist: xenial
services:
- docker
cache: cargo
branches:
  only:
  - master
  - "/^v\\d+\\.\\d+\\.\\d+.*$/"
install: cargo install cross
jobs:
  fast_finish: true
  include:
  - stage: prebuild
    name: Run tests
    install: skip
    script: skip
    # script: cargo test --features integration-test
  - stage: build
    name: x86_64-unknown-linux-gnu
    script: cross build --target x86_64-unknown-linux-gnu --release && tar -czvf $TRAVIS_BUILD_DIR/heliocron-x86_64-unknown-linux-gnu.tar.gz -C $TRAVIS_BUILD_DIR/target/x86_64-unknown-linux-gnu/release ./heliocron
  - name: armv7-unknown-linux-gnueabihf
    script: cross build --target armv7-unknown-linux-gnueabihf --release && tar -czvf $TRAVIS_BUILD_DIR/heliocron-armv7-unknown-linux-gnueabihf.tar.gz -C $TRAVIS_BUILD_DIR/target/armv7-unknown-linux-gnueabihf/release ./heliocron
  - name: arm-unknown-linux-gnueabihf
    script: cross build --target arm-unknown-linux-gnueabihf --release && tar -czvf $TRAVIS_BUILD_DIR/heliocron-arm-unknown-linux-gnueabihf.tar.gz -C $TRAVIS_BUILD_DIR/target/arm-unknown-linux-gnueabihf/release ./heliocron
  - stage: postbuild
    name: Post build
    install: skip
    script:
    - ls ./*.tar.gz
  - stage: deploy
    name: Publish to Github Releases and crates.io
    install: skip
    script: skip
    deploy:
    - provider: releases
      token:
        secure: h3kQpfc6khdkSlA50OIuOFGL7XDFt3xlDZsbNusNyZijkf1QLIsomb5JqgeocuXK2W3q35lg92MwKyEDkb38PMpU1RlV7WisR+PmoUegDtr5dGc28+hUAWE9d+d4uYmjg9B2EUGo4FAm3mM/cQ3+YhF6X84gqG0mQ46duJ35+tFxsaCq6XnulRx6y4C6t9syuRo6lDZWpuKkRxT+xMG8VznwflQw//T9TFdY/sspuWvjr1UeLQxZNpnX5AqpSX3m+GdN85JSGGpaN8W39ChC+5gGxYeFosx3Hslow9j69qU/40bKhyOqBXadD/CPlBU1MXiU6IDJ3JT4fbmgVBwpChtcyF7nC8kf+dD85Xyt3uwUEUiQFQhEsLsP2M+6SYyeO4RfObhfFYGBR3bW1bYoT0vMoHZWzwaGZcr2DjMeX/6OrLXDZQhfDMh6WgatzYb9jAyeY224hX3MuFrvJm12CsRLEUytYtZlDsdoOLpubj7ohiXebjHC1+eDQqqLrGVYETWk2De2v8PtuhvkWngQcH87MN8zBHNXnV2fDzGjGXskhdeORGNbFZv3Ji6oiwFeGuS5a8XObOk9fjiBi/wIuARvaKEcV1GhucjMnl4oRUpWBXoySZwqnWjxoexJIbex2wSiKIQqpj2DCbuxwlcQaOhM1b6uFsBpoXzvWxkF6iA=
      skip_cleanup: true
      draft: true
      file:
      - $TRAVIS_BUILD_DIR/target/x86_64-unknown-linux-gnu/release/heliocron-x86_64-unknown-linux-gnu.tar.gz
      - $TRAVIS_BUILD_DIR/target/armv7-unknown-linux-gnueabihf/release/heliocron-armv7-unknown-linux-gnueabihf.tar.gz
      - $TRAVIS_BUILD_DIR/target/arm-unknown-linux-gnueabihf/release/heliocron-arm-unknown-linux-gnueabihf.tar.gz
      on:
        branch: master
        repo: mfreeborn/heliocron
        tags: true
    - provider: cargo
      token:
        secure: f6OFe9j13g82osx8Y75Ia8Spg67gFNq3CCxxsjQS+yW4237ogsWsEqnnAahms5br4MmAAnYQ8R832FibLlpmLlVjTUAGz2/YksyYzLe1CEFwbNqPcg1f4/YLMgz0n+bY2aRhThnvQoCTWLTaQw9BuJ0WS0Rd26yOzdMqyMhX6LuNLsg03h2teWv6/7AxRAJOQlm8mPtEqxAfBiN0FGajouXo+5kbDvQT1C91wmr1jgEQwMUq2V6lEtvlYhMOrCks8Qo5GYJsQ4wUHH8J78wi1XC6yJBNmQg0StYkKIm+XbXNhbetiBA64WO26ByxlfyCuO1YPbqgPgGARrTYwIOXBqpIIpxb6+rlfZMpKtwQDsFhaIp6FztdKrXbVOzsag1MMSnV68AHQzsjgyXT70qTg7rjhzewaLiWW3w3XD73/XctmzNTmrlyUlwNs7qVLU44aJNk2BLwmNCVL844aU+v7EuiHDxZ4vn7TGRirj1SzJdv8oy6MuXnUugH+eEDAu3QU0IQD8HqFyeOTx7e5+4dghxxTy19vliZyBw3yRvA6HN0H3/Pq0g3PAtj1Rs8DYJkgmSAYJT84VVyHPXYF/OXoEmP/TOrYode5ykMXB+qxVsVlsdui3szLNydhGQbeVfjbHzGDRBA0fw7qXyucthj8bQbOEPZweQAcbxFx2QDszk=
      on:
        branch: master
        repo: mfreeborn/heliocron
        tags: true

notifications:
  email:
    on_success: never

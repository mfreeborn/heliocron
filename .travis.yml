language: rust
os: linux
dist: xenial

services:
  - docker

cache: cargo

jobs:
  fast_finish: true
  include:
    - stage: prebuild
      name: "Install cross"
      script: cargo install cross
    - name: "Run tests"
      script: cargo test --features integration-test
    - stage: build
      name: x86_64-unknown-linux-gnu
      script: cross build --target x86_64-unknown-linux-gnu --release
    - name: armv7-unknown-linux-gnueabihf
      script: cross build --target armv7-unknown-linux-gnueabihf --release
    - name: arm-unknown-linux-gnueabihf
      script: cross build --target arm-unknown-linux-gnueabihf --release